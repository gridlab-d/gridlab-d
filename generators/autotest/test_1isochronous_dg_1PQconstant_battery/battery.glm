//////////////////////////////////// Battery #1 M1/////////////////////////////////////////
object meter:1369 {
     phases "ABCN";
	 parent 151;
     name 1369;
     flags DELTAMODE;
     nominal_voltage 2401.7771;
}

// object recorder {
	// parent 1369;
	// property measured_real_power,measured_reactive_power,measured_current_A.real,measured_current_A.imag,measured_current_B.real,measured_current_B.imag,measured_current_C.real,measured_current_C.imag,voltage_A.real,voltage_A.imag,voltage_B.real,voltage_B.imag,voltage_C.real,voltage_C.imag;
	// interval 1;
	// flags DELTAMODE;
	// file Inverter_#1_MG1.csv;
// };

object inverter {
	name const_pq_inv;
	parent 1369;
	inverter_type FOUR_QUADRANT;
	use_multipoint_efficiency FALSE;
	four_quadrant_control_mode CONSTANT_PQ;
	generator_status ONLINE;
	inverter_efficiency 0.99;	

	rated_power 200 kVA;
	P_Out 80000;  // constant real power reference. In steady state, it will be the real power output; in delta mode, the real power output is trying to reach this value, if no droop is defined
	Q_Out 10000;
	V_In 1000+0j; // dc voltage
	I_In 1000+0j; // dc current

	flags DELTAMODE;
	dynamic_model_mode PI;
	inverter_convergence_criterion 0.001;
	
	// PI controller parameters
	kpd 0.001; 		// The d-axis proportionalgain for the current modulation PI controller.
	kid 0.05;		// The d-axis integration gain for the current modulation PI controller.
	kpq 0.001;		// The q-axis proportionalgain for the current modulation PI controller.
	kiq 0.05;		// The q-axis integration gain for the current modulation PI controller.
	
	// Droop curve parameters
	inverter_droop_fp false; 
	Tfreq_delay 0.01; 
	R_fp 0.000003;
	
	inverter_droop_vq false; 
	Tvol_delay 0.01; 
	R_vq 0.001;

	// object recorder {
		// property V_In,I_In,VA_In, Pref, Qref, VA_Out, VA_Out.real, VA_Out.imag;
		 // file PV1_pq_output.csv;
		 // flags DELTAMODE;
		 // interval 1;
	// };
	
	object complex_assert {
		flags DELTAMODE;
		target VA_Out;
		object player {
			flags DELTAMODE;
			property value;
			file "../constantPQ_battery_VA.csv";
		};
		within "0.1";
	};	
};	

object battery {
	name battery_1;
	parent const_pq_inv;
	use_internal_battery_model true;
	battery_type LI_ION;
	battery_capacity 500 kWh;
	base_efficiency 1;
	state_of_charge 0.5; // 1
	generator_mode SUPPLY_DRIVEN;
	
	flags DELTAMODE;
	
	// object recorder {
		// file "battery_pq_soc.csv";
		// property state_of_charge;
		// flags DELTAMODE;
		// interval 1;
		// };
		
	// object recorder {
		// file "battery_pq_status.csv";
		// property battery_state;
		// flags DELTAMODE;
		// interval 1;
	// };

}




